<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ambientação com o sistema operacional, ferramentas úteis e boas práticas na organização dos arquivos e documentos. "><meta name=author content="Anexo. 1 - Public Cloud Intro"><link href=https://github.com/Insper/guia-informatica/projetos/0.Cloud_Intro/ rel=canonical><link rel=icon href=../../assets/favicon.png><meta name=generator content="mkdocs-1.3.1, mkdocs-material-8.4.0"><title>Computação em Nuvem - Dicas de informática INSPER</title><link rel=stylesheet href=../../assets/stylesheets/main.69437709.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cbb835fc.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=https://cdn.jsdelivr.net/gh/insper-education/active-handout-css@main/devlife.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#objetivos class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Dicas de informática INSPER" class="md-header__button md-logo" aria-label="Dicas de informática INSPER" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Dicas de informática INSPER </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Computação em Nuvem </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=teal data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Insper/guia-informatica title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> insper.github.io/guia-informatica </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../slides/ class=md-tabs__link> Slides </a> </li> <li class=md-tabs__item> <a href=../../guia-informatica/ class=md-tabs__link> Windows </a> </li> <li class=md-tabs__item> <a href=../../guia-informatica/guia-macos/ class=md-tabs__link> MacOS </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Dicas de informática INSPER" class="md-nav__button md-logo" aria-label="Dicas de informática INSPER" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> Dicas de informática INSPER </label> <div class=md-nav__source> <a href=https://github.com/Insper/guia-informatica title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> insper.github.io/guia-informatica </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../slides/ class=md-nav__link> Slides </a> </li> <li class=md-nav__item> <a href=../../guia-informatica/ class=md-nav__link> Windows </a> </li> <li class=md-nav__item> <a href=../../guia-informatica/guia-macos/ class=md-nav__link> MacOS </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#objetivos class=md-nav__link> Objetivos </a> </li> <li class=md-nav__item> <a href=#primeira-instancia class=md-nav__link> Primeira Instância </a> </li> <li class=md-nav__item> <a href=#primeiro-deploy-ghost-blog-platform class=md-nav__link> Primeiro Deploy - Ghost Blog Platform </a> </li> <li class=md-nav__item> <a href=#escalabilidade class=md-nav__link> Escalabilidade </a> <nav class=md-nav aria-label=Escalabilidade> <ul class=md-nav__list> <li class=md-nav__item> <a href=#simulando-carga-no-servidor class=md-nav__link> Simulando carga no servidor </a> </li> <li class=md-nav__item> <a href=#escalando-verticalmente class=md-nav__link> Escalando Verticalmente </a> </li> <li class=md-nav__item> <a href=#escalando-horizontalmente class=md-nav__link> Escalando Horizontalmente </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/Insper/guia-informatica/edit/master/docs/projetos/0.Cloud_Intro.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1>Computação em Nuvem</h1> <h3 id=objetivos>Objetivos<a class=headerlink href=#objetivos title="Permanent link">&para;</a></h3> <ol> <li>Introduzir os conceitos básicos sobre cloud computing.</li> <li>Entender os conceitos básicos sobre IaaS.</li> </ol> <p>Pré-requisitos:</p> <ol> <li> <p>Realizar leitura prévia:</p> <blockquote> <p><a href=https://aws.amazon.com/pt/products/ >Produtos da AWS</a></p> <p><a href=http://redhatstackblog.redhat.com/2015/05/13/public-vs-private-amazon-compared-to-openstack/ >Public vs Private Cloud, AWS compared to Openstack</a></p> </blockquote> </li> <li> <p>Realizar a leitura sobre Cloud Computing. [Kavis - cap. 2 e Earl et al - cap. 4]</p> </li> </ol> <h2 id=primeira-instancia>Primeira Instância<a class=headerlink href=#primeira-instancia title="Permanent link">&para;</a></h2> <p>Vamos começar conhecendo o ferramental básico da AWS para <em>virtual machines</em>.</p> <ul> <li>Acessar o dashboard do EC2 de <em>North Virginia</em> (<strong>us-east-1</strong>).</li> <li>Criar uma instância t2.micro com <strong>Ubuntu 18.04 LTS</strong> server e 8Gb de disco.</li> <li>Renomear a máquina com o seu nome (<em>Tag</em>).</li> <li>Verifique se o <em>security group</em> liberou a conexão SSH externa.</li> <li>Importar em <em>Key Pair</em> a sua <em>public key</em> gerada na primeira aula. Coloque o seu nome na chave.<ul> <li>Endereço IP público da máquina:</li> </ul> </li> <li>Teste a conexão SSH (não se esqueça da chave privada).</li> </ul> <p>. Você criou uma policy para seu usuário. O que são <em>Policies</em>? Por que elas são importantes e devem ser bem definidas? . Dentro do contexto de Cloud Computing, defina os termos: <em>instance</em>, <em>image</em>, <em>region</em>, <em>VPC</em>, <em>subnet</em>, <em>security-group</em>. . O poder computacional das instâncias é medido em vCPU. O que é vCPU?</p> <h2 id=primeiro-deploy-ghost-blog-platform>Primeiro Deploy - Ghost Blog Platform<a class=headerlink href=#primeiro-deploy-ghost-blog-platform title="Permanent link">&para;</a></h2> <p>Vamos fazer um deploy completo e rápido com poucos comandos. Acesse o terminal da instância criada e execute os seguintes comandos:</p> <ul> <li>Atualize o S.O.<ul> <li>$ sudo apt update</li> </ul> </li> <li>Instale o conjure-up usando o snap<ul> <li>$ sudo snap install conjure-up --classic</li> </ul> </li> <li>Agora instale a plataforma Ghost<ul> <li>$ juju add-credential aws</li> <li>Insira um nome e a região correspondente: us-east-1</li> <li>Entre com o par <em>Access Key ID</em>/<em>Secret Access Key</em></li> <li>$ conjure-up battlemidget/ghost aws/us-east-1</li> <li>Aguarde.</li> </ul> </li> <li>Teste o deploy<ul> <li>$ juju status</li> <li>Anote o IP da aplicação HAProxy.</li> <li>Acesse a plataforma: https://[IP Público]/admin</li> </ul> </li> <li>Destrua tudo:<ul> <li>Anote o nome do controller no juju status</li> <li>$ juju kill-controller [controller-name]</li> <li>Aguarde e destrua a instância que você criou na AWS</li> </ul> </li> </ul> <p>. Quantas instâncias foram criadas automaticamente? Criar instâncias automaticamente é um atributo positivo ou negativo? . Quanto custou o protótipo? Assuma que usou uma semana de cada instância. . Dada a quantidade de computadores apontada na questão anterior, descreva como você montaria um ambiente Ghost em um Datacenter próprio. Assuma que você ainda não possui nenhum hardware disponível, apenas um orçamento aprovado. . Agora, somando o fato de que hardware deprecia com o tempo e possui um custo mensal de manutenção, compare em termos de custo uma <em>Public Cloud</em> e um Datacenter próprio.</p> <p>Como podem perceber a infraestrutura acima não custa barato ao longo do tempo. Talvez o uso do conjure-up/juju não seja o mais adequado para pequenos projetos. Outras alternativas para realizar provisionamento/implantação:</p> <ul> <li>Terraform: <a href=https://www.terraform.io/ >https://www.terraform.io/</a></li> <li>Ansible: <a href=https://www.ansible.com/ >https://www.ansible.com/</a></li> <li>Puppet: <a href=https://puppet.com/ >https://puppet.com/</a></li> </ul> <h2 id=escalabilidade>Escalabilidade<a class=headerlink href=#escalabilidade title="Permanent link">&para;</a></h2> <p>Conforme visto na Aula 01, vamos agora fazer uso de uma das mais poderosas características da nuvem.</p> <ul> <li>Crie uma instância t2.micro com Ubuntu 18.04 LTS:</li> <li>Renomeie a instância para <em>Webserver</em></li> <li>$ sudo apt update; sudo apt install nodejs build-essential -y</li> <li> <p>Edite um arquivo server.js:</p> <div class=highlight><pre><span></span><code><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=ch>#!/usr/bin/env nodejs</span><span class=w></span>
<a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a><span class=kd>var</span><span class=w> </span><span class=nx>http</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;http&#39;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=kd>var</span><span class=w> </span><span class=nx>os</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;os&#39;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=kd>var</span><span class=w> </span><span class=nx>crypto</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>require</span><span class=p>(</span><span class=s1>&#39;crypto&#39;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>
<a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a><span class=nx>http</span><span class=p>.</span><span class=nx>createServer</span><span class=p>(</span><span class=kd>function</span><span class=w> </span><span class=p>(</span><span class=nx>req</span><span class=p>,</span><span class=w> </span><span class=nx>res</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>writeHead</span><span class=p>(</span><span class=mf>200</span><span class=p>,</span><span class=w> </span><span class=p>{</span><span class=s1>&#39;Content-Type&#39;</span><span class=o>:</span><span class=w> </span><span class=s1>&#39;text/plain&#39;</span><span class=p>});</span><span class=w></span>
<a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=nx>nonce</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=mf>1</span><span class=p>;</span><span class=w></span>
<a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=nx>seed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nb>Math</span><span class=p>.</span><span class=nx>random</span><span class=p>();</span><span class=w></span>
<a id=__codelineno-0-10 name=__codelineno-0-10 href=#__codelineno-0-10></a><span class=w>  </span><span class=kd>var</span><span class=w> </span><span class=nx>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>crypto</span><span class=p>.</span><span class=nx>createHash</span><span class=p>(</span><span class=s1>&#39;sha256&#39;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-0-11 name=__codelineno-0-11 href=#__codelineno-0-11></a>
<a id=__codelineno-0-12 name=__codelineno-0-12 href=#__codelineno-0-12></a><span class=w>  </span><span class=nx>h</span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=ow>new</span><span class=w> </span><span class=nx>Buffer</span><span class=p>(</span><span class=nx>nonce</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot; Hello World &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>seed</span><span class=p>));</span><span class=w></span>
<a id=__codelineno-0-13 name=__codelineno-0-13 href=#__codelineno-0-13></a><span class=w>  </span><span class=k>while</span><span class=w> </span><span class=p>(</span><span class=nx>h</span><span class=p>.</span><span class=nx>digest</span><span class=p>(</span><span class=s2>&quot;hex&quot;</span><span class=p>).</span><span class=nx>substr</span><span class=p>(</span><span class=mf>0</span><span class=p>,</span><span class=mf>3</span><span class=p>)</span><span class=o>!=</span><span class=s1>&#39;000&#39;</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w></span>
<a id=__codelineno-0-14 name=__codelineno-0-14 href=#__codelineno-0-14></a><span class=w>    </span><span class=nx>h</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=nx>crypto</span><span class=p>.</span><span class=nx>createHash</span><span class=p>(</span><span class=s1>&#39;sha256&#39;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-0-15 name=__codelineno-0-15 href=#__codelineno-0-15></a><span class=w>    </span><span class=nx>nonce</span><span class=o>++</span><span class=p>;</span><span class=w></span>
<a id=__codelineno-0-16 name=__codelineno-0-16 href=#__codelineno-0-16></a><span class=w>    </span><span class=nx>h</span><span class=p>.</span><span class=nx>update</span><span class=p>(</span><span class=ow>new</span><span class=w> </span><span class=nx>Buffer</span><span class=p>(</span><span class=nx>nonce</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s2>&quot; Hello World &quot;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>seed</span><span class=p>));</span><span class=w></span>
<a id=__codelineno-0-17 name=__codelineno-0-17 href=#__codelineno-0-17></a><span class=w>  </span><span class=p>}</span><span class=w></span>
<a id=__codelineno-0-18 name=__codelineno-0-18 href=#__codelineno-0-18></a>
<a id=__codelineno-0-19 name=__codelineno-0-19 href=#__codelineno-0-19></a><span class=w>  </span><span class=nx>res</span><span class=p>.</span><span class=nx>end</span><span class=p>(</span><span class=s1>&#39;{ &quot;host&quot;: &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>os</span><span class=p>.</span><span class=nx>hostname</span><span class=p>()</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;, &quot;nonce&quot;: &#39;</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=nx>nonce</span><span class=w> </span><span class=o>+</span><span class=w> </span><span class=s1>&#39;}&#39;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-0-20 name=__codelineno-0-20 href=#__codelineno-0-20></a><span class=p>}).</span><span class=nx>listen</span><span class=p>(</span><span class=mf>8080</span><span class=p>,</span><span class=w> </span><span class=s1>&#39;&#39;</span><span class=p>);</span><span class=w></span>
<a id=__codelineno-0-21 name=__codelineno-0-21 href=#__codelineno-0-21></a><span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;Server running at http://localhost:8080/&#39;</span><span class=p>);</span><span class=w></span>
</code></pre></div> </li> <li> <p>Execute o serviço:</p> </li> <li>$ chmod +x ./server.js</li> <li>$ ./server.js</li> <li>Libere a porta no <em>security group</em> correspondente. Teste o serviço no browser.</li> <li>Ajustando o final:</li> <li>$ crontab -e\ <a class="magiclink magiclink-github magiclink-mention" href=https://github.com/reboot title="GitHub User: reboot">@reboot</a> /home/ubuntu/server.js</li> <li>$ sudo reboot</li> <li>Teste novamente no browser.</li> </ul> <blockquote> <p><img alt=💡 class=twemoji src=https://twemoji.maxcdn.com/v/latest/svg/1f4a1.svg title=:bulb:> Pesquise o que faz o crontab? </p> </blockquote> <h3 id=simulando-carga-no-servidor>Simulando carga no servidor<a class=headerlink href=#simulando-carga-no-servidor title="Permanent link">&para;</a></h3> <p>Uma das grande dúvidas de quem utiliza nuvem diz respeito a capacidade das instâncias utilizadas e se elas estão dimensiondas corretamente. Nessa etapa vamos estimar essa capacidade.</p> <ul> <li>Crie duas novas instâncias t2.micro com Ubuntu 18.04</li> <li>Renomeie como: Locust-master e Locust-worker</li> <li>Em ambas as máquinas:</li> <li>$ sudo apt update &amp;&amp; sudo apt install python3-pip -y</li> <li>$ pip3 install locust</li> <li>crie um arquivo locustfile.py no home: \vspace{0.3cm}</li> </ul> <p><div class=highlight><pre><span></span><code><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a>  <span class=kn>from</span> <span class=nn>locust</span> <span class=kn>import</span> <span class=n>HttpUser</span><span class=p>,</span> <span class=n>task</span><span class=p>,</span> <span class=n>between</span>
<a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>
<a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a>  <span class=k>class</span> <span class=nc>QuickstartUser</span><span class=p>(</span><span class=n>HttpUser</span><span class=p>):</span>
<a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
<a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a>      <span class=nd>@task</span>
<a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a>      <span class=k>def</span> <span class=nf>index_page</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
<a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>          <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&quot;/&quot;</span><span class=p>)</span>
</code></pre></div> \vspace{0.3cm} * no master: * liberar no <em>security group</em> as portas 8089 e 5557 * $ python3 -m locust -f /home/ubuntu/locustfile.py --master * No worker: * ajuste o número de conexões no Linux:\ $ sudo nano /etc/sysctl.conf * adicione a linha:\ fs.file-max = 5000000 * aplique as alterações:\ $ sudo sysctl -p * acerte o crontab para rodar na inicialização:\ python3 -m locust -f /home/ubuntu/locustfile.py --worker --master-host=[IP do master] * $ sudo reboot</p> <ul> <li>Realizando a simulação:</li> <li>acesse o locust master via browser</li> <li>aguarde o worker se conectar no master</li> <li>inicie um teste 300/10 - 300 usuários e <em>hatch rate</em> de 10 novos usuários por segundo.</li> <li><strong>Não caiu!</strong> - Talvez haja algumas poucas falhas.</li> <li> <p>verifique que essa aplicação suporta cerca de 100 rps (requisições por segundo).</p> </li> <li> <p>Multiplicando os usuários:</p> </li> <li>crie uma imagem do locust-worker. Café.</li> <li>crie mais 2 instâncias dessa AMI,</li> <li>Execute um teste 600/20 - observe que há algumas falhas mas ainda em um percentual baixo.</li> <li>Agora execute um teste 1000/50 - agora complicou.</li> </ul> <!-- 1. O que é AMI? \vspace{5.5cm} --> <h3 id=escalando-verticalmente>Escalando Verticalmente<a class=headerlink href=#escalando-verticalmente title="Permanent link">&para;</a></h3> <ul> <li>pare a máquina com o servidor http.</li> <li>troque para t2.2xlarge.</li> <li>atualize o IP no locust master, reinicie os workers e repita o teste 1000/50.</li> </ul> <!-- 1. Quais as diferenças técnicas entre uma t2.micro e t2.2xlarge? \vspace{6cm}
1. Por que a taxa de falhas ainda está alta? \vspace{5cm} --> <h3 id=escalando-horizontalmente>Escalando Horizontalmente<a class=headerlink href=#escalando-horizontalmente title="Permanent link">&para;</a></h3> <ul> <li>Crie uma imagem do servidor web. Café.</li> <li>Rebaixe a máquina para t2.micro de novo.</li> <li>Crie mais 2 instâncias a partir da AMI criada. Não esqueça de reutilizar o security group.</li> <li>Crie um <em>Application LoadBalancer</em> que mapeia instâncias:8080 para loadbalancer:80.</li> <li>Marcar todas as <em>Availability Zones</em>.</li> <li>Adicione as 3 instâncias no <em>Target Group</em>.</li> <li>Teste o acesso ao <em>LoadBalancer</em>:\vspace{0.5cm}</li> <li>Endereço DNS:\vspace{0.5cm}</li> <li>Verifique no navegador que há uma alternância do servidor.</li> <li>Execute novamente o teste 1000/50.</li> <li>Voilà!</li> </ul> <!-- 1. Existe também limitações no *LoadBalancer* ou basta adicionar máquinas? Teste à vontade.\vspace{5.5cm}
1. O que faz o *LoadBalancer*? Explique o algoritmo utilizado. \vspace{7cm} --> <p>Agora vamos ativar a elasticidade da nuvem.</p> <ul> <li>Remova as instâncias do LoadBalancer. Destrue-as.</li> <li>Crie um <em>Autoscalling Group</em>:</li> <li>Criar um <em>Launch Configuration</em> da mesma configuração em que foi criada a instância original. Reutilizar o <em>Security Group</em> com as devidas liberações.</li> <li>Começar com 1 instância.</li> <li>Selecionar todas as <em>subnets</em>.</li> <li>Anexar o <em>Target Group</em> criado anteriormente.</li> <li>Selecionar: <em>Use scaling policies to adjust the capacity of this group</em>. Usar <em>Request Count Per Target</em> em 3000 (50 rps x 60 segundos)</li> <li>Aguarde a primeira instância subir e teste o <em>LoadBalancer</em> de novo.</li> </ul> <p>Execute o teste 1000/50 novamente. Em 3 minutos ele se ajustará sozinho à demanda. Encerre o teste e em 15 minutos irá desativar a capacidade ociosa automaticamente. Remova tudo e não deixe nada rodando (Cuidado com os recursos do seu colega).</p> <!-- 1. Enfim, como funciona o *Autoscalling Group* da AWS? \vspace{5cm}
1. Qual a diferença entre escalabilidade horizontal e escalabilidade vertical? \vspace{7cm}
1. Qualquer serviço/aplicativo pode fazer uso da escalabilidade horizontal? Um banco de dados pode? \vspace{5cm} --> <!-- ## Questões Complementares

1. O que é um *VPS*? Qual a diferença entre uma instância e um *VPS*? \vspace{5cm}
1. Defina *Platform as a Service* (PaaS) e *Software as a Service* (SaaS).  \vspace{5.5cm}
1. O modelo *LoadBalancer* possui um custo fixo elevado. Como você justificaria o uso e a configuração de um *LoadBalancer* para uma empresa? \vspace{5cm}

## Concluindo

1. Defina *Public Cloud*. Cite a principal vantagem e desvantagem.  \vspace{6cm}
1. Defina *Infrastructure as a Service* (Iaas).  \vspace{6cm}
1. Defina Escalabilidade.  \vspace{6cm}

**Conclusão:** Imagine como é o processo de alocação de uma instância. O que é realmente uma instância? Como você montaria um ambiente similar a AWS em um Datacenter próprio? --> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2023 - Tiago Demay </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/squidfunk target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://gitter.im/squidfunk/mkdocs-material target=_blank rel=noopener title=gitter.im class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 384 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg> </a> <a href=https://hub.docker.com/r/squidfunk/mkdocs-material/ target=_blank rel=noopener title=hub.docker.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M349.9 236.3h-66.1v-59.4h66.1v59.4zm0-204.3h-66.1v60.7h66.1V32zm78.2 144.8H362v59.4h66.1v-59.4zm-156.3-72.1h-66.1v60.1h66.1v-60.1zm78.1 0h-66.1v60.1h66.1v-60.1zm276.8 100c-14.4-9.7-47.6-13.2-73.1-8.4-3.3-24-16.7-44.9-41.1-63.7l-14-9.3-9.3 14c-18.4 27.8-23.4 73.6-3.7 103.8-8.7 4.7-25.8 11.1-48.4 10.7H2.4c-8.7 50.8 5.8 116.8 44 162.1 37.1 43.9 92.7 66.2 165.4 66.2 157.4 0 273.9-72.5 328.4-204.2 21.4.4 67.6.1 91.3-45.2 1.5-2.5 6.6-13.2 8.5-17.1l-13.3-8.9zm-511.1-27.9h-66v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm78.1 0h-66.1v59.4h66.1v-59.4zm-78.1-72.1h-66.1v60.1h66.1v-60.1z"/></svg> </a> <a href=https://pypi.org/project/mkdocs-material/ target=_blank rel=noopener title=pypi.org class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.8 200.5c-7.7-30.9-22.3-54.2-53.4-54.2h-40.1v47.4c0 36.8-31.2 67.8-66.8 67.8H172.7c-29.2 0-53.4 25-53.4 54.3v101.8c0 29 25.2 46 53.4 54.3 33.8 9.9 66.3 11.7 106.8 0 26.9-7.8 53.4-23.5 53.4-54.3v-40.7H226.2v-13.6h160.2c31.1 0 42.6-21.7 53.4-54.2 11.2-33.5 10.7-65.7 0-108.6zM286.2 404c11.1 0 20.1 9.1 20.1 20.3 0 11.3-9 20.4-20.1 20.4-11 0-20.1-9.2-20.1-20.4.1-11.3 9.1-20.3 20.1-20.3zM167.8 248.1h106.8c29.7 0 53.4-24.5 53.4-54.3V91.9c0-29-24.4-50.7-53.4-55.6-35.8-5.9-74.7-5.6-106.8.1-45.2 8-53.4 24.7-53.4 55.6v40.7h106.9v13.6h-147c-31.1 0-58.3 18.7-66.8 54.2-9.8 40.7-10.2 66.1 0 108.6 7.6 31.6 25.7 54.2 56.8 54.2H101v-48.8c0-35.3 30.5-66.4 66.8-66.4zm-6.7-142.6c-11.1 0-20.1-9.1-20.1-20.3.1-11.3 9-20.4 20.1-20.4 11 0 20.1 9.2 20.1 20.4s-9 20.3-20.1 20.3z"/></svg> </a> <a href=https://www.linkedin.com/in/tiago-demay target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.ecf98df9.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.9c69f0bc.min.js></script> <script src=https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.0.0/js-yaml.min.js></script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script> <script src=https://cdn.jsdelivr.net/gh/insper-education/active-handout-plugins-js@main/package/plugin-bundle.js></script> </body> </html>